import{a as kt,c as yt}from"./chunk-GFTAKBCK.js";import{a as Hi}from"./chunk-I45SCJS7.js";import{a as ot}from"./chunk-FT62FQFN.js";import{a as St,b as Vi,c as Ui}from"./chunk-HCO2HEL2.js";import{b as fi}from"./chunk-YOD26Q3B.js";import{c as Zt}from"./chunk-AMMCLHNQ.js";import{a as et,b as Li,c as Pi}from"./chunk-3NHYXP5X.js";import{c as xi,d as Oi}from"./chunk-V7IAVRAT.js";import{a as Ti,b as Ri}from"./chunk-ZDVT23G7.js";import{a as ui,b as bi,c as _i}from"./chunk-SQOIDT5J.js";import"./chunk-ISWHXR5X.js";import{c as zi}from"./chunk-QV2VT3T6.js";import{a as Pt,b as gi,c as at}from"./chunk-KMMM7LTP.js";import{a as Bi}from"./chunk-CWKPO4JT.js";import{a as ji,b as Ni}from"./chunk-ALGLUMIM.js";import{a as ci,b as si,e as mi,f as nt,g as pi,h as Ct,k as rt,l as vi,m as wi,n as ki,o as yi,p as Ci,q as Ii,r as Mi,s as Ei,t as Si,u as Fi,v as Ai,w as Di,x as Mt,y as Et}from"./chunk-25NNDTFO.js";import{b as It}from"./chunk-HOXLKUOK.js";import{q as hi}from"./chunk-HNMGAJEO.js";import"./chunk-EJJBCPAK.js";import{a as Kt,b as ut,d as bt,e as Yt,f as Lt,h as _t,i as Jt,j as ti,l as ii,m as ei,n as ft,o as xt,p as vt,s as tt,t as wt}from"./chunk-DS4W2E5P.js";import{a as ni}from"./chunk-7KPXEIKL.js";import{a as $,b as it}from"./chunk-DORSZTD2.js";import{B as oi,J as B,N as ri,O as li,R as di,r as ai}from"./chunk-A4FPPA6U.js";import"./chunk-T6WYW2DS.js";import{b as $t}from"./chunk-UFZ5HBZB.js";import{Ab as n,Bb as e,Ca as Q,Cb as h,Db as Z,Eb as K,Gb as A,Hc as Xt,Jb as x,Jc as X,Kb as w,Pb as Y,Qb as q,Rb as W,Tb as r,Ub as U,Vb as u,Wb as Ht,Xb as Qt,Ya as d,Yb as T,Z as ht,Za as N,Zb as L,_ as R,_b as P,ac as y,ca as pt,da as M,ea as Vt,fc as Gt,gb as Tt,gc as qt,ja as k,ka as j,mc as Wt,ob as C,qb as g,sa as st,ta as _,ua as f,va as gt,vb as O,wa as Ot,wb as G,xb as mt,yb as S,za as Ut,zb as F}from"./chunk-P2XP77ST.js";import{a as jt,b as Nt,g as Dt,i as Bt}from"./chunk-P2VZOJAX.js";var Ft=class{constructor(){this.Descripcion="",this.UsuarioAsignado="",this.dependecarga=0,this.descripcion="",this.detalle=[],this.estado="",this.fechacarga="",this.fechacreacion="",this.fechainicio="",this.fechamodificacion="",this.idcarga=0,this.rucempresa="",this.totalregistros=0,this.usuarioAsignado="",this.usuariocreacion="",this.usuariomodificacion=""}};var v=Dt(Pt());function pe(i,c){if(i&1&&(n(0,"tr",10)(1,"td",11),r(2),e(),n(3,"td",11),r(4),e(),n(5,"td",11),r(6),e(),n(7,"td",11),r(8),e(),n(9,"td",11),r(10),e(),n(11,"td",11),r(12),e(),n(13,"td",11),r(14),e(),n(15,"td",11),r(16),e(),n(17,"td",11),r(18),e(),n(19,"td",11),r(20),e(),n(21,"td",11),r(22),e(),n(23,"td",11),r(24),e(),n(25,"td",11),r(26),e(),n(27,"td",11),r(28),e(),n(29,"td",11),r(30),e()()),i&2){let t=c.$implicit;d(2),u(" ",t.almacen," "),d(2),u(" ",t.sucursal," "),d(2),u(" ",t.zona," "),d(2),u(" ",t.pasillo," "),d(2),u(" ",t.rack," "),d(2),u(" ",t.ubicacion," "),d(2),u(" ",t.esagrupado," "),d(2),u(" ",t.codigogrupo," "),d(2),u(" ",t.codigoproducto," "),d(2),u(" ",t.codigobarra," "),d(2),u(" ",t.descripcionproducto," "),d(2),u(" ",t.Unidad," "),d(2),u(" ",t.stockL," "),d(2),u(" ",t.stockF," "),d(2),u(" ",t.stockresultante," ")}}var Qi=(()=>{class i{constructor(){this.excelData=[]}static{this.\u0275fac=function(a){return new(a||i)}}static{this.\u0275cmp=k({type:i,selectors:[["preview-carga-inventarios"]],inputs:{excelData:"excelData"},standalone:!0,features:[y],decls:45,vars:0,consts:[["tabindex","-1","id","hs-detalle-excel_preview","aria-labelledby","offcanvasRightLabel",1,"offcanvas","offcanvas-end","ancho"],[1,"offcanvas-header","bg-fondo-detalle"],["id","hs-detalle-excel_preview",1,"offcanvas-title","titulo-detalle"],["type","button","data-bs-dismiss","offcanvas","aria-label","Close",1,"btn-close"],[1,"offcanvas-body","max-h-full","overflow-y-auto"],[1,"p-4"],[1,"min-w-full","bg-white","border","border-gray-200","rounded-lg","shadow-md"],[1,"bg-gray-100"],["scope","col",1,"px-6","py-2","text-left","text-xs","font-medium","text-gray-500","uppercase","tracking-wider"],[1,"divide-y","divide-gray-200"],[1,"hover:bg-gray-50"],[1,"px-6","py-1.5","whitespace-nowrap","text-sm","text-gray-900"]],template:function(a,o){a&1&&(n(0,"div",0)(1,"div",1)(2,"h5",2),r(3,"Preview "),n(4,"span"),r(5,"Datos"),e()(),h(6,"button",3),e(),n(7,"div",4)(8,"div",5)(9,"table",6)(10,"thead",7)(11,"tr")(12,"th",8),r(13," Almacen "),e(),n(14,"th",8),r(15," Sucursal "),e(),n(16,"th",8),r(17," Zona "),e(),n(18,"th",8),r(19," Pasillo "),e(),n(20,"th",8),r(21," Rack "),e(),n(22,"th",8),r(23," Ubicaci\xF3n "),e(),n(24,"th",8),r(25," Esagrupado "),e(),n(26,"th",8),r(27," CodigoGrupo "),e(),n(28,"th",8),r(29," CodigoProducto "),e(),n(30,"th",8),r(31," CodigoBarra "),e(),n(32,"th",8),r(33," Descripci\xF3n Producto "),e(),n(34,"th",8),r(35," Unidad "),e(),n(36,"th",8),r(37," Stock L "),e(),n(38,"th",8),r(39," Stock F "),e(),n(40,"th",8),r(41," Stock Resultante "),e()()(),n(42,"tbody",9),S(43,pe,31,15,"tr",10,G),e()()()()()),a&2&&(d(43),F(o.excelData))},styles:['.ancho[_ngcontent-%COMP%]{width:100rem}#hs-detalle-excel_preview[_ngcontent-%COMP%]{z-index:1060!important}.containar_ver_detalle[_ngcontent-%COMP%]{height:2rem;padding:0 1rem;display:flex;align-items:center;border-radius:10px;justify-content:space-between;background-color:var(--color-principal-4)}.containar_ver_detalle[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%]{color:var(--color-principal-1);font-weight:700;font-size:.8rem}.containar_ver_detalle[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{color:var(--color-principal-5);font-weight:700}.Nombre_Inventario[_ngcontent-%COMP%]{display:flex;flex-direction:column}.Nombre_Inventario[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{text-align:left}.Nombre_Inventario[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{border:1px solid var(--color-principal-5)}.Buttons_eventos[_ngcontent-%COMP%]{display:flex;gap:1rem;margin-top:1rem}.Buttons_eventos[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{flex:1}.button_cancelar[_ngcontent-%COMP%]{padding:.625rem 1rem;display:inline-flex;justify-content:center;align-items:center;gap:.5rem;font-size:.875rem;font-weight:500;border-radius:.5rem;border:1px solid transparent;background-color:transparent;color:var(--color-principal-5);transition:background-color .2s}.Buttons_eventos[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:last-child{background-color:var(--color-principal-3);color:#fff}.bg-fondo-detalle[_ngcontent-%COMP%]{background-image:url("./media/bg_fondo-CXGFOBCI.webp");background-size:cover;background-position:center;background-repeat:no-repeat}.titulo-detalle[_ngcontent-%COMP%]{color:#fff;font-size:1.5rem}.titulo-detalle[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{color:#00d1ae}']})}}return i})();function ue(i,c){if(i&1&&(n(0,"option",10),r(1),e()),i&2){let t=c.$implicit;g("value",t),d(),U(t)}}function be(i,c){if(i&1){let t=A();n(0,"div",2)(1,"label",7),r(2),e(),n(3,"select",8),P("ngModelChange",function(o){let l=_(t).$implicit,s=w();return L(s.selectedColumns[l],o)||(s.selectedColumns[l]=o),f(o)}),n(4,"option",9),r(5,"Seleccionar columna"),e(),S(6,ue,2,2,"option",10,mt),e()()}if(i&2){let t=c.$implicit,a=w();d(2),u(" ",a.columnasEsperadas[t],": "),d(),T("ngModel",a.selectedColumns[t]),d(3),F(a.columnasExcel)}}function _e(i,c){if(i&1&&(n(0,"option",10),r(1),e()),i&2){let t=c.$implicit;g("value",t),d(),U(t)}}function fe(i,c){if(i&1){let t=A();n(0,"div",2)(1,"label",7),r(2),e(),n(3,"select",8),P("ngModelChange",function(o){let l=_(t).$implicit,s=w();return L(s.selectedColumns[l],o)||(s.selectedColumns[l]=o),f(o)}),n(4,"option",9),r(5,"Seleccionar columna"),e(),S(6,_e,2,2,"option",10,mt),e()()}if(i&2){let t=c.$implicit,a=w();d(2),u(" ",a.columnasEsperadas[t],": "),d(),T("ngModel",a.selectedColumns[t]),d(3),F(a.columnasExcel)}}var Gi=(()=>{class i{constructor(){this.columnasEsperadas={},this.columnasExcel=[],this.mapeoGuardado={},this.columnasMapeadas=new Q,this.selectedColumns={},this.Object=Object}ngOnInit(){console.log(this.columnasMapeadas),Object.keys(this.columnasEsperadas).forEach(t=>{this.selectedColumns[t]=this.mapeoGuardado[t]||""})}confirmarSeleccion(){this.columnasMapeadas.emit(this.selectedColumns)}cancelarSeleccion(){this.columnasMapeadas.emit()}esSeleccionValida(){return Object.keys(this.columnasEsperadas).every(t=>this.selectedColumns[t]&&this.selectedColumns[t]!=="")}static{this.\u0275fac=function(a){return new(a||i)}}static{this.\u0275cmp=k({type:i,selectors:[["column-matcher"]],inputs:{columnasEsperadas:"columnasEsperadas",columnasExcel:"columnasExcel",mapeoGuardado:"mapeoGuardado"},outputs:{columnasMapeadas:"columnasMapeadas"},standalone:!0,features:[y],decls:16,vars:0,consts:[["label","Datos principales"],[1,"p-4"],[1,"flex","gap-4","items-center","mb-2"],["label","Datos Secundarios"],[1,"flex","justify-end","gap-2","mt-4"],[1,"px-4","py-2","bg-gray-500","text-white","rounded","hover:bg-gray-600",3,"click"],[1,"px-4","py-2","bg-blue-500","text-white","rounded","hover:bg-blue-600",3,"click"],[1,"w-[15rem]","text-right","text-gray-600","font-medium"],[1,"w-full","p-2","border","rounded-md","bg-gray-100",3,"ngModelChange","ngModel"],["value",""],[3,"value"]],template:function(a,o){a&1&&(n(0,"h1"),r(1,"RELACIONA TUS COLUMNAS"),e(),n(2,"mat-tab-group")(3,"mat-tab",0)(4,"div",1),S(5,be,8,2,"div",2,mt),e()(),n(7,"mat-tab",3)(8,"div",1),S(9,fe,8,2,"div",2,mt),e()()(),n(11,"div",4)(12,"button",5),x("click",function(){return o.cancelarSeleccion()}),r(13," Cancelar "),e(),n(14,"button",6),x("click",function(){return o.confirmarSeleccion()}),r(15," Confirmar "),e()()),a&2&&(d(5),F(o.Object.keys(o.columnasEsperadas).slice(0,6)),d(4),F(o.Object.keys(o.columnasEsperadas).slice(6)))},dependencies:[X,wt,xt,vt,ft,bt,tt,Jt,ui,_i,bi],styles:[".ancho[_ngcontent-%COMP%]{width:100%}select[_ngcontent-%COMP%]{height:3.5rem;background-color:#f7f7f7;border:none}"]})}}return i})();var At=(()=>{class i{UpdateMapeoById(t){return this.httpClient.post(`${this.URL}/ActualizarMapeoCampos`,t,{headers:{"Content-Type":"application/json"}})}newMapeo(t){return this.httpClient.post(`${this.URL}/InsertarMapeoCampos`,t,{headers:{"Content-Type":"application/json"}})}getMapeoById(t){return this.httpClient.post(`${this.URL}/ObtenerMapeoCamposById`,t,{headers:{"Content-Type":"application/json"}})}constructor(t){this.httpClient=t,this.URL=ni.api}static{this.\u0275fac=function(a){return new(a||i)(pt($t))}}static{this.\u0275prov=ht({token:i,factory:i.\u0275fac,providedIn:"root"})}}return i})();var we=["fileInput"];function ke(i,c){if(i&1&&(n(0,"option",15),r(1),e()),i&2){let t=c.$implicit;g("value",t.rucempresa),d(),Ht(" ",t.rucempresa," - ",t.razonsocial," ")}}function ye(i,c){if(i&1&&(n(0,"option",15),r(1),e()),i&2){let t=w().$implicit;g("value",t.idusuario),d(),Qt(" ",t.idusuario," - ",t.nombreusuario," ",t.apellido," ")}}function Ce(i,c){if(i&1&&C(0,ye,2,4,"option",15),i&2){let t=c.$implicit;O(0,t.estado=="1"?0:-1)}}function Ie(i,c){if(i&1&&(n(0,"span",26),r(1," Archivo seleccionado: "),n(2,"span",36),r(3),e()()),i&2){let t=w();d(3),U(t.selectedFileName)}}function Me(i,c){i&1&&(n(0,"span",26),r(1," Haz clic aqu\xED "),n(2,"span",36),r(3,"para seleccionar su archivo"),e()())}function Ee(i,c){if(i&1&&(n(0,"span",27),r(1),e()),i&2){let t=w();d(),u("Tama\xF1o de archivo: ",t.fileDetails.size," bytes")}}function Se(i,c){i&1&&(n(0,"span",27),r(1,"M\xE1ximo un archivo de 10 Mb"),e())}function Fe(i,c){if(i&1){let t=A();n(0,"input",37),P("ngModelChange",function(o){_(t);let l=w();return L(l.Cabecera.descripcion,o)||(l.Cabecera.descripcion=o),f(o)}),e()}if(i&2){let t=w();T("ngModel",t.Cabecera.descripcion),g("value",t.selectedFileName)}}function Ae(i,c){if(i&1){let t=A();n(0,"input",37),P("ngModelChange",function(o){_(t);let l=w();return L(l.Cabecera.descripcion,o)||(l.Cabecera.descripcion=o),f(o)}),e()}if(i&2){let t=w();T("ngModel",t.Cabecera.descripcion),g("value",t.selectedFileName)}}var qi=(()=>{class i{constructor(t,a,o,l,s){this.cargaExcelsService=t,this._empresas=a,this._postCabecera=o,this.router=l,this._mapeo=s,this.mensajeCompleto="Error al cargar el archivo",this.tituloSwalCorrecto="CONFIRMACI\xD3N",this.selectedFileName="",this.selectedFile=null,this.fileDetails=null,this.cantidadDatosExcel=0,this.detalle=[],this.HayArchivo=!1,this.usuarioLogueado="",this.excelData=[],this.DatosEmpresas=[],this.getUsuarios_All=[],this.Cabecera=new Ft,this.formularioRegistro=new Lt({}),this.activarGuardar=!1,this.activarButton=!1,this.listaUsuarios=M(et),this.columnasEsperadas={almacen:"Almac\xE9n",sucursal:"Sucursal",zona:"Zona",pasillo:"Pasillo",rack:"Rack",ubicacion:"Ubicaci\xF3n",esagrupado:"Es Agrupado",codigogrupo:"C\xF3digo Grupo",codigoproducto:"C\xF3digo Producto",codigobarra:"C\xF3digo Barra",descripcionProducto:"Descripci\xF3n Producto",Unidad:"Unidad",stockL:"Stock L\xF3gico"},this.columnasExcel=[],this.columnasMapeadas={},this.injector=Vt(Ut),this.appRef=M(Wt),this.viewContainerRef=M(Tt),this.mapeoCamposService=M(At)}ngOnInit(){this.listarUsuarios(),this.listaEmpresas(),this.validandoArchivoPreview(),this.formularioRegistro=new Lt({rucempresa:new _t("",[ut.required]),descripcion:new _t("",[ut.required,ut.minLength(5)]),usuarioasignado:new _t("",[])}),this.formularioRegistro.patchValue({descripcion:this.Cabecera.descripcion||""}),this.formularioRegistro.patchValue({rucempresa:this.Cabecera.rucempresa||""}),this.formularioRegistro.patchValue({usuarioasignado:this.Cabecera.UsuarioAsignado||""})}listarUsuarios(){try{this.UsuariosSubscription=this.listaUsuarios.ListarusUarios().subscribe(t=>{this.getUsuarios_All=t.usuarios})}catch{}}guardarCabecera(){this.formularioRegistro.value.usuarioasignado.trim()==""?v.default.fire({title:"No se asign\xF3 un usuario al inventario",text:"\xBFEst\xE1s seguro de registrar sin asignar?",icon:"warning",showCancelButton:!0,confirmButtonColor:"#00D1AE",cancelButtonColor:"#888888",confirmButtonText:"Continuar",cancelButtonText:"Cancelar"}).then(t=>{t.isConfirmed?this.validacionGuardarFinal():v.default.close()}):this.validacionGuardarFinal()}confirmarSeleccion(){this.validacionGuardarFinal()}guardarColumnasMapeadas(t){this.columnasMapeadas=t}validacionGuardarFinal(){let t=sessionStorage.getItem("user");if(this.selectedFile){let a=new FileReader;a.readAsArrayBuffer(this.selectedFile),a.onload=()=>Bt(this,null,function*(){let o=new Uint8Array(a.result),l=kt(o,{type:"array"}),s=l.Sheets[l.SheetNames[0]],m=yt.sheet_to_json(s,{raw:!1});if(m.length===0){v.default.fire({icon:"error",title:"Error",text:"El archivo no contiene datos."});return}let I=Object.keys(m[0]||{});console.log("Columnas detectadas en el Excel:",I);let p={codigobarra:"C\xF3digo Barra",codigoproducto:"C\xF3digo Producto",stockL:"Stock L\xF3gico",descripcionProducto:"Descripci\xF3n Producto",Unidad:"Unidad",almacen:"Almac\xE9n",sucursal:"Sucursal",zona:"Zona",pasillo:"Pasillo",rack:"Rack",ubicacion:"Ubicaci\xF3n",codigogrupo:"C\xF3digo Grupo"};try{let D={id:1},V=yield this._mapeo.getMapeoById(D).toPromise();(!V||!V.mapeo)&&console.warn("El backend no devolvi\xF3 un mapeo v\xE1lido.");let J=V?.mapeo?JSON.parse(V.mapeo):{},z=this.viewContainerRef.createComponent(Gi);z.instance.columnasEsperadas=p,z.instance.columnasExcel=I,z.instance.mapeoGuardado=J,z.instance.columnasMapeadas.subscribe(H=>{H?(v.default.close(),this.previewDatos(m,H,t)):v.default.close()});let b=z.location.nativeElement;v.default.fire({html:"",width:"40%",showConfirmButton:!1,showCancelButton:!1,didOpen:()=>{v.default.getHtmlContainer()?.appendChild(b)}}).then(()=>{z.destroy()})}catch(D){console.error("Error al obtener el mapeo guardado",D)}})}}procesarDatos(t,a,o){let l=t.length,s=500,m=0;v.default.fire({title:"Guardando registros...",html:"<b>Iniciando carga de datos...</b>",allowOutsideClick:!1,didOpen:()=>{v.default.showLoading()}});let I=p=>{if(p>=l){v.default.close(),this.mensajeCargaExcelCorrecta("Carga completada");return}let D=Math.min(p+s,l),V=t.slice(p,D).map(b=>Object.keys(a).reduce((H,dt)=>{let ct=b[a[dt]]||"";return["stockL"].includes(dt)&&(ct=typeof ct=="string"&&ct.trim()===""?0:parseFloat(ct)||0),H[dt]=ct,H},{})),J=o??"Registro sistema",z=Nt(jt({},this.Cabecera),{usuariocreacion:J,usuariomodificacion:J,dependecarga:0,totalregistros:l,estado:"1",descripcion:this.formularioRegistro.value.descripcion.toUpperCase(),detalle:V,usuarioAsignado:this.formularioRegistro.value.usuarioasignado,fechainicio:this.Cabecera.fechainicio||""});this._postCabecera.newCabecera(z).subscribe({next:b=>{m+=V.length,v.default.update({html:`<b>Guardando registros ${m} de ${l}</b>`}),setTimeout(()=>I(D),100)},error:b=>{console.error("Error al registrar:",b),v.default.close(),this.mensajeCargaExcelError("Error al registrar la cabecera y detalle",b)}})};I(0)}previewDatos(t,a,o){let l=Object.keys(a),s=t.slice(0,5).map(I=>l.reduce((p,D)=>(p[D]=I[a[D]]||"",p),{})),m=`<table style="width:100%; border-collapse: collapse; text-align:left;">
          <thead>
              <tr>${l.map(I=>`<th style="border: 1px solid #ddd; padding: 8px; background: #f3f3f3;">${a[I]}</th>`).join("")}</tr>
          </thead>
          <tbody>
              ${s.map(I=>`<tr>${l.map(p=>`<td style="border: 1px solid #ddd; padding: 8px;">${I[p]}</td>`).join("")}</tr>`).join("")}
          </tbody>
      </table>`;v.default.fire({title:"Vista previa reducida de los datos a guardar",html:m,width:"80%",showCancelButton:!0,confirmButtonText:"Guardar",cancelButtonText:"Cancelar"}).then(I=>{I.isConfirmed&&this.guardarMapeo(o,a,t)})}guardarMapeo(t,a,o){if(!t){v.default.fire("Error","Usuario no identificado","error");return}let l={usuarioId:parseInt(t,10),nombreConfiguracion:sessionStorage.getItem("user")??"system",mapeo:JSON.stringify(a)};this.mapeoCamposService.newMapeo(l).subscribe({next:s=>{v.default.fire("\xC9xito",s.mensaje,"success"),this.procesarDatos(o,a,t)},error:s=>{console.error("Error al guardar el mapeo:",s),v.default.fire("Error","No se pudo guardar el mapeo","error")}})}validarExistenciaDeMapeoGuardado(){let t={id:1};this.mapeoCamposService.UpdateMapeoById(t).subscribe({next:a=>{},error:a=>{console.error("Error al obtener el mapeo:",a),v.default.fire("Error","No se pudo obtener el mapeo","error")}})}validandoArchivoPreview(){this.selectedFileName!=null&&this.selectedFileName.trim()!==""?this.HayArchivo=!0:this.HayArchivo=!1}onFileSelected(t){let a=t.target;if(a.files&&a.files.length>0){let o=a.files[0],l=["xlsx","xls"],s=o.name.split(".").pop()?.toLowerCase();if(!s||!l.includes(s)){v.default.fire({icon:"error",title:"Archivo no permitido",text:"Por favor, seleccione un archivo Excel (.xlsx o .xls)."});return}this.selectedFile=o,this.selectedFileName=this.selectedFile.name,this.fileDetails={name:this.selectedFile.name,size:this.selectedFile.size,type:this.selectedFile.type,lastModified:this.selectedFile.lastModified},this.HayArchivo=!0;let m=new FileReader;m.onload=I=>{let p=new Uint8Array(m.result),D=kt(p,{type:"array"}),V=D.SheetNames[0],J=D.Sheets[V],z=yt.sheet_to_json(J,{header:1});this.excelData=z.slice(1).map(b=>{let H={almacen:b[0]||"",sucursal:b[1]||"",zona:b[2]||"",pasillo:b[3]||"",rack:b[4]||"",ubicacion:b[5]||"",esagrupado:b[6]||"",codigogrupo:b[7]||"",codigoproducto:b[8]||"",codigobarra:b[9]||"",descripcionproducto:b[10]||"",Unidad:b[11]||"",stockL:b[12]||0,stockF:b[13]||0,stockresultante:0};return Object.values(H).every(dt=>!dt)?null:H}).filter(b=>b!==null),this.cantidadDatosExcel=this.excelData.length},m.readAsArrayBuffer(this.selectedFile)}}uploadFile(t,a){if(this.selectedFile){let o=new FileReader;o.readAsArrayBuffer(this.selectedFile),o.onload=()=>{let l=new Uint8Array(o.result),s=kt(l,{type:"array"}),m=s.Sheets[s.SheetNames[0]],I=yt.sheet_to_json(m);this.detalle=I.map(p=>({almacen:p.almacen||"",sucursal:p.sucursal||"",zona:p.zona||"",pasillo:p.pasillo||"",rack:p.rack||"",ubicacion:p.ubicacion||"",esagrupado:p.esagrupado||"",codigogrupo:p.codigogrupo||"",codigoproducto:p.codigoproducto||"",Codigobarra:p.Codigobarra||"",descripcionProducto:p.descripcionProducto||"",Unidad:p.Unidad||"",stockL:p.stockL||0,stockF:p.stockF||0,stockresultante:0,esnuevo:0,ajuste:0,descripcionajuste:"",nroitem:0}))}}}mensajeCargaExcelCorrecta(t){this.mensajeCompleto=t.count+" "+t.message,v.default.fire({position:"center",icon:"success",title:"REGISTRO CORRECTO",showConfirmButton:!0}).then(()=>{window.location.reload()})}mensajeCargaExcelError(t,a){v.default.fire({icon:"error",title:"Oops...",text:`${t} ${a}`})}listaEmpresas(){this.empresasSubscription=this._empresas.ListarEmpresas().subscribe(t=>{this.DatosEmpresas=t.empresas})}mensajeValidacionRegistroCorrecto(t){let a=t&&t.msgerror?t.msgerror:"Inventario creado correctamente.";v.default.fire(`${this.tituloSwalCorrecto}`,a,"success").then(()=>{window.location.reload()})}mapExcelRow(t){return{almacen:t[0]||"",sucursal:t[1]||"",zona:t[2]||"",pasillo:t[3]||"",rack:t[4]||"",ubicacion:t[5]||"",esagrupado:t[6]||"",codigogrupo:t[7]||"",codigoproducto:t[8]||"",codigobarra:t[9]||"",descripcionproducto:t[10]||"",unidad:t[11]||"",stockL:t[12]||0,stockF:t[13]||0,stockresultante:t[14]||0}}limpiarDatosPreview(){window.location.reload()}ngOnDestroy(){this.empresasSubscription?.unsubscribe(),this.UsuariosSubscription?.unsubscribe()}static{this.\u0275fac=function(a){return new(a||i)(N(fi),N(ot),N(It),N(Zt),N(At))}}static{this.\u0275cmp=k({type:i,selectors:[["registro-carga-inventarios"]],viewQuery:function(a,o){if(a&1&&Y(we,5),a&2){let l;q(l=W())&&(o.fileInput=l.first)}},standalone:!0,features:[y],decls:54,vars:8,consts:[["fileInput",""],["id","registrarInventario","data-bs-backdrop","static","data-bs-keyboard","false","tabindex","-1","aria-labelledby","staticBackdropLabel","aria-hidden","true",1,"modal","fade"],[1,"modal-dialog"],[1,"modal-content"],[1,"modal-header"],["id","staticBackdropLabel",1,"modal-title","fs-5","mb-0","text-blue-900"],["type","button","data-bs-dismiss","modal","aria-label","Close",1,"btn-close"],[1,"modal-body"],[3,"ngSubmit","formGroup"],[1,"px-4","py-0","gap-0","text-center","overflow-y-auto"],[1,"flex-1","mt-0"],[1,"mb-1"],["for","empresas",1,"w-full","text-left","form-label"],["id","empresas","formControlName","rucempresa","aria-label","Default select example",1,"form-select",3,"ngModelChange","ngModel"],["value","","disabled","","selected",""],[3,"value"],[1,"flex-1"],["id","usuarioAsignar","formControlName","usuarioasignado","aria-label","Default select example",1,"form-select",3,"ngModelChange","ngModel"],[1,"flex-1","mt-1"],[1,""],[1,"container-space-y-2"],["for","af-submit-app-upload-images",1,"upload-label"],["id","af-submit-app-upload-images","name","af-submit-app-upload-images","type","file","accept",".xlsx, .xls",1,"upload-input",3,"change"],["xmlns","http://www.w3.org/2000/svg","width","16","height","16","fill","currentColor","viewBox","0 0 16 16",1,"upload-icon","dark"],["fill-rule","evenodd","d","M7.646 5.146a.5.5 0 0 1 .708 0l2 2a.5.5 0 0 1-.708.708L8.5 6.707V10.5a.5.5 0 0 1-1 0V6.707L6.354 7.854a.5.5 0 1 1-.708-.708l2-2z"],["d","M4.406 3.342A5.53 5.53 0 0 1 8 2c2.69 0 4.923 2 5.166 4.579C14.758 6.804 16 8.137 16 9.773 16 11.569 14.502 13 12.687 13H3.781C1.708 13 0 11.366 0 9.318c0-1.763 1.266-3.223 2.942-3.593.143-.863.698-1.723 1.464-2.383zm.653.757c-.757.653-1.153 1.44-1.153 2.056v.448l-.445.049C2.064 6.805 1 7.952 1 9.318 1 10.785 2.23 12 3.781 12h8.906C13.98 12 15 10.988 15 9.773c0-1.216-1.02-2.228-2.313-2.228h-.5v-.5C12.188 4.825 10.328 3 8 3a4.53 4.53 0 0 0-2.941 1.1z"],[1,"upload-text"],[1,"upload-help"],[1,"Nombre_Inventario"],["for","af-submit-project-url",1,"inline-block","text-sm","font-medium","text-gray-800","mt-2.5"],["formControlName","descripcion","id","af-submit-project-url","type","text","placeholder","Ingresar nombre",1,"py-2","px-3","pe-11","block","w-full","border-gray-200","shadow-sm","text-sm","rounded-lg","focus:ring-blue-500","disabled:opacity-50","disabled:pointer-events-none",3,"ngModel","value"],[1,"modal-footer"],[1,"Buttons_eventos"],["type","button","data-bs-dismiss","modal",3,"click"],["type","submit",1,"btn","btn-primary",3,"disabled"],[3,"excelData"],[1,"upload-highlight"],["formControlName","descripcion","id","af-submit-project-url","type","text","placeholder","Ingresar nombre",1,"py-2","px-3","pe-11","block","w-full","border-gray-200","shadow-sm","text-sm","rounded-lg","focus:ring-blue-500","disabled:opacity-50","disabled:pointer-events-none",3,"ngModelChange","ngModel","value"]],template:function(a,o){if(a&1){let l=A();n(0,"div",1)(1,"div",2)(2,"div",3)(3,"div",4)(4,"h1",5),r(5,"REGISTRO INVENTARIO"),e(),h(6,"button",6),e(),n(7,"div",7)(8,"form",8),x("ngSubmit",function(){return _(l),f(o.guardarCabecera())}),n(9,"div",9)(10,"div",10)(11,"div",11)(12,"label",12),r(13,"Empresas"),e(),n(14,"select",13),P("ngModelChange",function(m){return _(l),L(o.Cabecera.rucempresa,m)||(o.Cabecera.rucempresa=m),f(m)}),n(15,"option",14),r(16," Seleccione una empresa "),e(),S(17,ke,2,3,"option",15,G),e()()(),n(19,"div",16)(20,"div",11)(21,"label",12),r(22,"Asignar usuario"),e(),n(23,"select",17),P("ngModelChange",function(m){return _(l),L(o.Cabecera.UsuarioAsignado,m)||(o.Cabecera.UsuarioAsignado=m),f(m)}),n(24,"option",14),r(25," Seleccione una Usuario "),e(),S(26,Ce,1,1,null,null,G),e()()(),n(28,"div",18)(29,"div",19)(30,"div",20)(31,"label",21)(32,"input",22,0),x("change",function(m){return _(l),f(o.onFileSelected(m))}),e(),gt(),n(34,"svg",23),h(35,"path",24)(36,"path",25),e(),C(37,Ie,4,1,"span",26)(38,Me,4,0),Ot(),h(39,"br"),C(40,Ee,2,1,"span",27)(41,Se,2,0),e()()(),n(42,"div",28)(43,"label",29),r(44," Nombre "),e(),C(45,Fe,1,2,"input",30)(46,Ae,1,2),e(),n(47,"div",31)(48,"div",32)(49,"button",33),x("click",function(){return _(l),f(o.limpiarDatosPreview())}),r(50," Cancelar "),e(),n(51,"button",34),r(52," Siguiente "),e()()()()()()()()()(),h(53,"preview-carga-inventarios",35)}a&2&&(d(8),g("formGroup",o.formularioRegistro),d(6),T("ngModel",o.Cabecera.rucempresa),d(3),F(o.DatosEmpresas),d(6),T("ngModel",o.Cabecera.UsuarioAsignado),d(3),F(o.getUsuarios_All),d(11),O(37,o.selectedFileName?37:38),d(3),O(40,o.selectedFileName?40:41),d(5),O(45,o.selectedFileName?45:46),d(6),g("disabled",!o.HayArchivo||o.formularioRegistro.controls.rucempresa.invalid||o.formularioRegistro.controls.descripcion.invalid),d(2),g("excelData",o.excelData))},dependencies:[tt,ti,xt,vt,Kt,ft,bt,Yt,wt,ii,ei,X,Qi,nt,Ct,at],styles:['.container-formulario[_ngcontent-%COMP%]{display:flex;height:100%}form[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]{height:3.5rem;background-color:#f7f7f7;border:none}form[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{margin-top:1rem;color:#0158dd}form[_ngcontent-%COMP%]   .containar_ver_detalle[_ngcontent-%COMP%]{height:3.5rem;background-color:transparent;padding:0 1rem;display:flex;border-radius:10px;align-items:center;justify-content:space-between}form[_ngcontent-%COMP%]   .containar_ver_detalle[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%]{color:var(--color-principal-1);font-weight:700;font-size:.9rem}form[_ngcontent-%COMP%]   .containar_ver_detalle[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{color:var(--color-principal-5);font-weight:700}form[_ngcontent-%COMP%]   .Nombre_Inventario[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{height:3.5rem;background-color:#f7f7f7}.Nombre_Inventario[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{text-align:left}.container_seleccion_archivo[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%]{color:var(--color-principal-3);font-weight:800}.container_seleccion_archivo[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{color:#fff;font-size:.8rem}mat-form-field[_ngcontent-%COMP%]{width:100%}.container-space-y-2[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.5rem;background-color:#f0f0f0;border-radius:5px;margin:1rem 0}.upload-label[_ngcontent-%COMP%]{padding:1rem;display:block;text-align:center;cursor:pointer;border-radius:.5rem;outline:none;transition:all .2s ease}.upload-label[_ngcontent-%COMP%]:focus-within{ring-color:#00D1AE;box-shadow:0 0 0 2px #00d1ae,0 0 0 4px #e5e7eb}.upload-label[_ngcontent-%COMP%]:hover{background-color:#e5e7eb33}.upload-label.dark[_ngcontent-%COMP%]{border-color:#3f3f3f}.upload-input[_ngcontent-%COMP%]{position:absolute;width:0;height:0;opacity:0;overflow:hidden}.upload-icon[_ngcontent-%COMP%]{width:2rem;height:2rem;margin:0 auto;color:#9ca3af}.upload-icon.dark[_ngcontent-%COMP%]{color:#4b5563}.upload-text[_ngcontent-%COMP%]{font-size:.875rem;color:#1f2937}.upload-text.dark[_ngcontent-%COMP%]{color:var(--color-principal-5)}.upload-highlight[_ngcontent-%COMP%]{color:#00d1ae;transition:color .2s ease}.upload-highlight[_ngcontent-%COMP%]:hover{color:#00d1ae}.upload-help[_ngcontent-%COMP%]{margin-top:.25rem;font-size:.75rem;color:#6b7280}.upload-help.dark[_ngcontent-%COMP%]{color:#9ca3af}.Nombre_Inventario[_ngcontent-%COMP%]{display:flex;flex-direction:column}.Buttons_eventos[_ngcontent-%COMP%]{display:flex;gap:1rem;margin-top:1rem}.Buttons_eventos[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{flex:1}.button_cancelar[_ngcontent-%COMP%]{padding:.625rem 1rem;display:inline-flex;justify-content:center;align-items:center;gap:.5rem;font-size:.875rem;font-weight:500;border-radius:.5rem;border:1px solid transparent;background-color:transparent;color:var(--color-principal-5);transition:background-color .2s}.Buttons_eventos[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:last-child{background-color:var(--color-principal-3);color:#fff}.bg-fondo-detalle[_ngcontent-%COMP%]{background-image:url("./media/bg_fondo-CXGFOBCI.webp");background-size:cover;background-position:center;background-repeat:no-repeat}.titulo-detalle[_ngcontent-%COMP%]{color:#fff;font-size:1.5rem}.titulo-detalle[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{color:#00d1ae}.swal2-input[_ngcontent-%COMP%]{height:3.5rem;background-color:#f7f7f7;border:none}.input-descripcion[_ngcontent-%COMP%]{display:flex;gap:.3rem}.input-descripcion[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{border-radius:10px;background-color:#0158dd;color:#fff}@media (max-width: 480px){.container_seleccion_archivo[_ngcontent-%COMP%]{height:50vh;display:flex;flex-direction:column}.container-space-y-2[_ngcontent-%COMP%]{display:flex;flex:1;justify-content:center;flex-direction:column;gap:.5rem;background-color:#f0f0f0;border-radius:5px;margin:1rem 0}}']})}}return i})();var lt=Dt(Pt());var Wi=(()=>{class i{static{this.\u0275fac=function(a){return new(a||i)}}static{this.\u0275cmp=k({type:i,selectors:[["registro-producto-new-inventario"]],standalone:!0,features:[y],decls:96,vars:0,consts:[["tabindex","-1","id","newProducts","aria-labelledby","newProducts",1,"offcanvas","offcanvas-end","ancho"],[1,"offcanvas-header"],["id","newProducts",1,"offcanvas-title"],["type","button","data-bs-dismiss","offcanvas","aria-label","Close",1,"btn-close"],[1,"offcanvas-body"],[1,"p-4","gap-8","text-center","overflow-y-auto"],[1,"flex-1"],[1,"text-center"],["id","hs-ai-modal-label",1,"text-lg","font-semibold","text-gray-800"],[1,"text-sm","text-gray-500","dark:text-neutral-500"],[1,"mt-5","mb-5","sm:mt-10","grid","grid-cols-2","sm:grid-cols-3","gap-5"],[1,"block","text-xs","uppercase","text-gray-500","dark:text-neutral-500"],[1,"block","text-sm","font-medium","text-gray-800"],[1,"flex-col","lg:flex","lg:gap-6","lg:flex-row"],[1,"Almacen_Inventario","mt-2"],["for","af-submit-project-url",1,"inline-block","text-left","w-full","text-sm","font-medium","text-gray-800","mt-2.5"],["formControlName","descripcion","id","af-submit-project-url","type","text","placeholder","Ingresar nombre",1,"py-2","px-3","pe-11","border","block","w-full","border-gray-200","shadow-sm","text-sm","rounded-lg","focus:ring-blue-500","disabled:opacity-50","disabled:pointer-events-none"],["for","af-submit-project-url",1,"inline-block","text-left","w-full","text-sm","font-medium","text-gray-800","mt-2.5","''"],[1,"Buttons_eventos"],["type","button","data-hs-overlay","#hs-sign-out-alert-mas-productos",1,"button_cancelar"],["type","submit",1,"py-2.5","px-4","w-full","inline-flex","justify-center","items-center","gap-x-2","text-sm","font-medium","rounded-lg","border","border-gray-200","bg-ring-blue-500","text-gray-800","shadow-sm","hover:bg-gray-50","disabled:opacity-50","disabled:pointer-events-none","focus:outline-none","focus:bg-gray-50"]],template:function(a,o){a&1&&(n(0,"div",0)(1,"div",1)(2,"h5",2),r(3,"Offcanvas right"),e(),h(4,"button",3),e(),n(5,"div",4)(6,"form")(7,"div",5)(8,"div",6)(9,"div",7)(10,"h3",8),r(11," REGISTRAR PRODUCTO NUEVO INVENTARIO "),e(),n(12,"p",9),r(13," Datos a registrar "),e()(),n(14,"div",10)(15,"div")(16,"span",11),r(17,"Fecha Creaci\xF3n:"),e(),n(18,"span",12),r(19,"05/12/2024"),e()(),n(20,"div")(21,"span",11),r(22,"Estado:"),e(),n(23,"span",12),r(24,"Activo"),e()(),n(25,"div")(26,"span",11),r(27,"Ruc Empresa:"),e(),n(28,"span",12),r(29,"10733567363"),e()()()(),n(30,"div",13)(31,"div",6)(32,"div",14)(33,"label",15),r(34," Almac\xE9n "),e(),h(35,"input",16),e(),n(36,"div",14)(37,"label",17),r(38," sucursal "),e(),h(39,"input",16),e(),n(40,"div",14)(41,"label",15),r(42," Almac\xE9n "),e(),h(43,"input",16),e(),n(44,"div",14)(45,"label",15),r(46," Almac\xE9n "),e(),h(47,"input",16),e()(),n(48,"div",6)(49,"div",14)(50,"label",15),r(51," Almac\xE9n "),e(),h(52,"input",16),e(),n(53,"div",14)(54,"label",15),r(55," Almac\xE9n "),e(),h(56,"input",16),e(),n(57,"div",14)(58,"label",15),r(59," Almac\xE9n "),e(),h(60,"input",16),e(),n(61,"div",14)(62,"label",15),r(63," Almac\xE9n "),e(),h(64,"input",16),e()(),n(65,"div",6)(66,"div",14)(67,"label",15),r(68," Almac\xE9n "),e(),h(69,"input",16),e(),n(70,"div",14)(71,"label",15),r(72," Almac\xE9n "),e(),h(73,"input",16),e(),n(74,"div",14)(75,"label",15),r(76," Almac\xE9n "),e(),h(77,"input",16),e(),n(78,"div",14)(79,"label",15),r(80," Almac\xE9n "),e(),h(81,"input",16),e()(),n(82,"div",6)(83,"div",14)(84,"label",15),r(85," Almac\xE9n "),e(),h(86,"input",16),e(),n(87,"div",14)(88,"label",15),r(89," Almac\xE9n "),e(),h(90,"input",16),e()()()(),n(91,"div",18)(92,"button",19),r(93," Cancelar "),e(),n(94,"button",20),r(95," Guardar "),e()()()()())},styles:[".ancho[_ngcontent-%COMP%]{width:70rem}.Buttons_eventos[_ngcontent-%COMP%]{display:flex;gap:1rem;margin-top:1rem}.Buttons_eventos[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{flex:1}.button_cancelar[_ngcontent-%COMP%]{padding:.625rem 1rem;display:inline-flex;justify-content:center;align-items:center;gap:.5rem;font-size:.875rem;font-weight:500;border-radius:.5rem;border:1px solid transparent;background-color:transparent;color:var(--color-principal-5);transition:background-color .2s}.Buttons_eventos[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:last-child{background-color:var(--color-principal-3);color:#fff}"]})}}return i})();var Zi=(()=>{class i{static{this.\u0275fac=function(a){return new(a||i)}}static{this.\u0275mod=j({type:i})}static{this.\u0275inj=R({})}}return i})();var ee=(()=>{class i{static{this.\u0275fac=function(a){return new(a||i)}}static{this.\u0275mod=j({type:i})}static{this.\u0275inj=R({imports:[B,Zi,hi]})}}return i})();var ae=(()=>{class i{constructor(){this.rucempresa="",this.idcarga=0,this.obtenerDetalle=new Q}ObtenerDetatosInventarios(){this.obtenerDetalle.emit({rucempresa:this.rucempresa,idcarga:this.idcarga})}static{this.\u0275fac=function(a){return new(a||i)}}static{this.\u0275cmp=k({type:i,selectors:[["button-asignar"]],inputs:{rucempresa:"rucempresa",idcarga:"idcarga"},outputs:{obtenerDetalle:"obtenerDetalle"},standalone:!0,features:[y],decls:3,vars:0,consts:[["type","button","data-bs-toggle","modal","data-bs-target","#staticBackdrop","aria-controls","hs-detalles-inventario",1,"flex","shrink-0","justify-center","items-center","gap-2","size-11","text-sm","font-medium","rounded-lg","border-transparent","bg-white","text-blue-700","hover:bg-blue-700","focus:outline-hidden","focus:bg-blue-700","disabled:opacity-50","disabled:pointer-events-none",3,"click"]],template:function(a,o){a&1&&(n(0,"button",0),x("click",function(){return o.ObtenerDetatosInventarios()}),n(1,"mat-icon"),r(2,"person_add"),e()())},dependencies:[rt,it,$]})}}return i})();var oe=(()=>{class i{constructor(){this.datosInventario={},this.rucempresa="",this.idcarga=0,this.obtenerDetalle=new Q}ObtenerDetatosInventarios(){this.obtenerDetalle.emit({rucempresa:this.rucempresa,idcarga:this.idcarga})}static{this.\u0275fac=function(a){return new(a||i)}}static{this.\u0275cmp=k({type:i,selectors:[["button-anular-inventario"]],inputs:{datosInventario:"datosInventario",rucempresa:"rucempresa",idcarga:"idcarga"},outputs:{obtenerDetalle:"obtenerDetalle"},standalone:!0,features:[y],decls:3,vars:0,consts:[["type","button","data-bs-toggle","offcanvas","aria-controls","hs-detalles-inventario",1,"flex","shrink-0","justify-center","items-center","gap-2","size-11","text-sm","font-medium","rounded-lg","border-transparent","bg-white","text-blue-700","hover:bg-blue-700","focus:outline-hidden","focus:bg-blue-700","disabled:opacity-50","disabled:pointer-events-none",3,"click"],[1,"text-blue-600]"]],template:function(a,o){a&1&&(n(0,"button",0),x("click",function(){return o.ObtenerDetatosInventarios()}),n(1,"mat-icon",1),r(2,"delete"),e()())},dependencies:[rt,it,$]})}}return i})();var re=(()=>{class i{constructor(t){this.inventariosService=t}anularInventario(t){return this.inventariosService.anularInventario(t)}static{this.\u0275fac=function(a){return new(a||i)(pt(It))}}static{this.\u0275prov=ht({token:i,factory:i.\u0275fac,providedIn:"root"})}}return i})();var le=(()=>{class i{static{this.\u0275fac=function(a){return new(a||i)}}static{this.\u0275mod=j({type:i})}static{this.\u0275inj=R({imports:[B,B]})}}return i})();var de=(()=>{class i{static{this.\u0275fac=function(a){return new(a||i)}}static{this.\u0275mod=j({type:i})}static{this.\u0275inj=R({imports:[ai,X,B,ri,li,le]})}}return i})();function Pe(i,c){if(i&1&&(n(0,"mat-option",8)(1,"div",5)(2,"div",6)(3,"span",38),r(4),e(),n(5,"span",39),r(6),e()()()()),i&2){let t=c.$implicit;g("value",t.rucempresa),d(4),u(" ",t.rucempresa||"Sin RUC"," "),d(2),u(" ",t.razonsocial||"Sin raz\xF3n social"," ")}}function ze(i,c){if(i&1&&(n(0,"mat-option",10),r(1),e()),i&2){let t=c.$implicit;g("value",t.value),d(),U(t.viewValue)}}function Re(i,c){i&1&&(n(0,"th",40),r(1," Carga Inventario "),e())}function je(i,c){if(i&1&&(n(0,"td",41)(1,"span",42),r(2),Gt(3,"date"),e()()),i&2){let t=c.$implicit;d(2),U(qt(3,1,t.fechacreacion,"dd/MM/yyyy"))}}function Ne(i,c){i&1&&(n(0,"th",40),r(1," Descripci\xF3n "),e())}function Be(i,c){if(i&1&&(n(0,"td",41)(1,"span",43),r(2),e()()),i&2){let t=c.$implicit;d(2),u(" ",t.descripcion.toUpperCase()||"- sin nombre -"," ")}}function Ve(i,c){i&1&&(n(0,"th",44),r(1," Total \xCDtems "),e())}function Ue(i,c){if(i&1&&(n(0,"td",45)(1,"span",46),r(2),e()()),i&2){let t=c.$implicit;d(2),u(" ",t.totalregistros||"-"," ")}}function He(i,c){i&1&&(n(0,"th",40),r(1," Usuario Asignado "),e())}function Qe(i,c){if(i&1&&(n(0,"td",41)(1,"span",42),r(2),e()()),i&2){let t=c.$implicit;d(2),U(t.UsuarioAsignado||"-")}}function Ge(i,c){i&1&&(n(0,"th",47),r(1," Estado "),e())}function qe(i,c){i&1&&h(0,"td-estado-1")}function We(i,c){i&1&&h(0,"td-estado-2",49)}function Xe(i,c){i&1&&h(0,"td-estado-3",50),i&2&&g("estado","Anulado")}function $e(i,c){if(i&1&&(n(0,"td",48),C(1,qe,1,0,"td-estado-1")(2,We,1,0,"td-estado-2",49)(3,Xe,1,1,"td-estado-3",50),e()),i&2){let t=c.$implicit;d(),O(1,t.estado=="1"?1:-1),d(),O(2,t.estado=="2"?2:-1),d(),O(3,t.estado=="0"?3:-1)}}function Ze(i,c){i&1&&(n(0,"th",51),r(1," Operaciones "),e())}function Ke(i,c){if(i&1){let t=A();n(0,"button-asignar",53),x("obtenerDetalle",function(o){_(t);let l=w(2);return f(l.ObtenerDetatosInventarios(o.rucempresa,o.idcarga))}),e(),n(1,"button-anular-inventario",54),x("obtenerDetalle",function(o){_(t);let l=w(2);return f(l.ObtenerDatosAnularInventario(o.rucempresa,o.idcarga))}),e()}if(i&2){let t=w().$implicit,a=w();g("idcarga",t.idcarga)("rucempresa",t.rucempresa),d(),g("idcarga",t.idcarga)("rucempresa",t.rucempresa)("datosInventario",a.datosInventario)}}function Ye(i,c){if(i&1){let t=A();n(0,"td",48)(1,"div",52)(2,"td-table-btn-detalle",53),x("obtenerDetalle",function(o){_(t);let l=w();return f(l.ObtenerDetalleInventarios(o.rucempresa,o.idcarga))}),e(),C(3,Ke,2,5),e()()}if(i&2){let t=c.$implicit;d(2),g("idcarga",t.idcarga)("rucempresa",t.rucempresa),d(),O(3,t.estado=="1"?3:-1)}}function Je(i,c){i&1&&h(0,"tr",55)}function tn(i,c){i&1&&h(0,"tr",56)}var ce=(()=>{class i{constructor(){this.dataListaInventarios=[],this.filtrosInventario=new Q,this.displayedColumns=["fechacreacion","descripcion","totalregistros","UsuarioAsignado","estado","operaciones"],this.dataSource=new Et([]),this.listaEmpresas=M(ot),this.ObjectInventario=M(Ti),this.ListDetalleInventario=M(Ri),this.listaUsuarios=M(et),this._liveAnnouncer=M(oi),this.descripcionButtonAnular="",this.cantidadDatosInventarioLista=0,this.cantidadListaProductos=0,this.currentPage=1,this.p=1,this.datosInventario={},this.detalleInvenario=[],this.listaProductos=[],this.DatosEmpresas=[],this.datosInventarioslista=[],this.getUsuarios_All=[],this.paginatedProductos=[],this.showListOpciones=!1,this.filtroEstados=[{value:"",viewValue:"Todos"},{value:"1",viewValue:"Activos"},{value:"0",viewValue:"Inactivos"},{value:"2",viewValue:"Inventariados"}],this.selected="1",this.selectedEmpresa="",this.ObjectInventarioAnular=M(re)}applyFilter(t){let a=t.target.value;this.dataSource.filter=a.trim().toLowerCase(),this.dataSource.paginator&&this.dataSource.paginator.firstPage()}ngAfterViewInit(){this.dataSource.paginator=this.paginator,this.dataSource.sort=this.sort}ngOnChanges(t){t.dataListaInventarios&&(this.dataSource.data=this.dataListaInventarios||[])}ngOnInit(){this.ObtenerEmpresas(),this.listarUsuarios()}announceSortChange(t){t.direction?this._liveAnnouncer.announce(`Sorted ${t.direction}ending`):this._liveAnnouncer.announce("Sorting cleared")}verListOpciones(){this.showListOpciones=!this.showListOpciones}ObtenerEmpresas(){this.EmpresasSubscription=this.listaEmpresas.ListarEmpresas().subscribe(t=>{this.DatosEmpresas=t.empresas})}emitirFiltros(){this.filtrosInventario.emit({estado:this.selected,rucempresa:this.selectedEmpresa})}recargarPagina(){window.location.reload()}listarUsuarios(){try{this.UsuariosSubscription=this.listaUsuarios.ListarusUarios().subscribe(t=>{this.getUsuarios_All=t.usuarios})}catch{}}ObtenerDatosAddProductos(t,a){let o={rucempresa:t,idcarga:a};this.ObjectInventario.getInventarioById(o).subscribe(l=>{this.datosInventario=l})}ObtenerDetatosInventarios(t,a){let o={rucempresa:t,idcarga:a};this.ObjectInventario.getInventarioById(o).subscribe(l=>{this.datosInventario=l})}ObtenerDatosAnularInventario(t,a){let o={rucempresa:t,idcarga:a};this.ObjectInventario.getInventarioById(o).subscribe(l=>{this.datosInventario=l,l.estado=="1"&&this.Alert_AnularInventario(l)})}Alert_AnularInventario(t){let a=3;lt.default.fire({title:`<div class="text-red-600 text-2xl font-bold flex items-center justify-center">
                <span>Anular Inventario</span>
              </div>`,html:`
        <div class="border-b border-gray-300 pb-4">
          <p class="text-gray-700 text-lg text-center">
            \xBFSeguro que deseas anular <span class="font-bold text-red-500">${t.descripcion}</span>?
          </p>
        </div>

        <div class="mt-4 text-left space-y-3">
          <p class="text-gray-600 text-sm text-center">Esta acci\xF3n no se puede deshacer.</p>
          <p class="text-gray-600 text-sm text-center">Aseg\xFArate de revisar antes de continuar.</p>
        </div>

        <!-- Contenedor de botones para asegurar su visibilidad -->
        <div id="swal-buttons" class="flex justify-center gap-4 mt-5">
          <button id="cancel-btn" class="bg-gray-500 hover:bg-gray-500 text-white font-semibold px-4 py-2 rounded w-36">
            Cancelar
          </button>
          <button id="confirm-btn" class="bg-red-600  text-white font-semibold px-4 py-2 rounded w-36" disabled>
            S\xED, Anular (3)
          </button>
        </div>
      `,icon:"warning",showConfirmButton:!1,showCancelButton:!1,didOpen:()=>{let o=document.getElementById("cancel-btn"),l=document.getElementById("confirm-btn");o&&(o.onclick=()=>lt.default.close());let s=setInterval(()=>{a--,l.textContent=`S\xED, Anular (${a})`,a===0&&(clearInterval(s),l.textContent="S\xED, Anular",l.disabled=!1,l.classList.add("hover:bg-red-700"))},1e3);l&&(l.onclick=()=>{lt.default.close(),this.ResponseAnularInventarioInventarioSeleccionado()})}})}ResponseAnularInventarioInventarioSeleccionado(){let t=this.datosInventario.rucempresa,a=sessionStorage.getItem("user")??"System",o=this.datosInventario.idcarga,s={rucempresa:t,idcarga:o,usuarioAnulador:a,estado:"0"};s.usuarioAnulador=a,s.rucempresa=t,s.idcarga=o,this.ObjectInventarioAnular.anularInventario(s).subscribe(m=>{m.exito?this.Alert_InventarioAnulado_Correctamente():this.Alert_InventarioAnulado_Error()})}Alert_InventarioAnulado_Correctamente(){lt.default.fire({title:"Anulado!",text:"El inventario se anul\xF3 de manera correcta",icon:"success"}).then(()=>{window.location.reload()})}Alert_InventarioAnulado_Error(){lt.default.fire({icon:"error",title:"Oops...",text:"No se pudo anular el inventario, intente nuevamente"})}ObtenerDetalleInventarios(t,a){let o={rucempresa:t,idcarga:a};this.ListDetalleInventario.getDetalleInventario(o).subscribe(l=>{this.listaProductos=l,this.cantidadListaProductos=l.length}),this.ObtenerDetatosInventarios(t,a)}ngOnDestroy(){this.EmpresasSubscription&&this.EmpresasSubscription.unsubscribe(),this.UsuariosSubscription?.unsubscribe()}static{this.\u0275fac=function(a){return new(a||i)}}static{this.\u0275cmp=k({type:i,selectors:[["lista-inventarios-cargados"]],viewQuery:function(a,o){if(a&1&&(Y(vi,5),Y(St,5)),a&2){let l;q(l=W())&&(o.paginator=l.first),q(l=W())&&(o.sort=l.first)}},inputs:{dataListaInventarios:"dataListaInventarios"},outputs:{filtrosInventario:"filtrosInventario"},standalone:!0,features:[st,y],decls:54,vars:13,consts:[["input",""],[1,"max-w-[100rem]","py-2","lg:py-0","mx-auto","flex","gap-2"],[1,"w-[21rem]"],["panelClass","custom-panel",3,"valueChange","selectionChange","value"],["value",""],[1,"flex","items-center","gap-4","p-3","rounded-lg","border-b","border-gray-200","last:border-none","hover:bg-gray-100","transition","duration-300","ease-in-out"],[1,"flex","flex-col","flex-grow"],[1,"text-gray-600","text-sm","leading-tight","w-64"],[3,"value"],[3,"valueChange","selectionChange","value"],[1,"text-indigo-500","font-semibold","text-sm","leading-tight",3,"value"],[1,"w-[22rem]","transition","duration-300","ease-in-out"],["matPrefix","",1,"text-gray-500","transition","duration-200"],["matInput","","placeholder","Buscar",1,"text-gray-800","placeholder-gray-400","focus:outline-none",3,"keyup"],[1,"max-w-[100rem]","mx-auto","h-auto"],[1,"flex","flex-col"],[1,"-m-1.5","overflow-x-auto","h-auto"],[1,"p-1.5","min-w-full","inline-block","align-middle"],[1,"bg-white","border","border-gray-200","rounded-xl","shadow-md"],[1,"overflow-hidden","rounded-xl"],["mat-table","","matSort","",1,"min-w-full","border","border-gray-300","rounded-lg","overflow-hidden",3,"dataSource"],["matColumnDef","fechacreacion"],["mat-header-cell","","mat-sort-header","","class","text-left px-4 py-2 bg-gray-200 font-semibold text-gray-800",4,"matHeaderCellDef"],["mat-cell","","class","px-4 py-2 border-b border-gray-200",4,"matCellDef"],["matColumnDef","descripcion"],["matColumnDef","totalregistros"],["mat-header-cell","","mat-sort-header","","class","text-right px-4 py-2 bg-gray-200 font-semibold text-gray-800",4,"matHeaderCellDef"],["mat-cell","","class","px-4 py-2 text-right border-b border-gray-200",4,"matCellDef"],["matColumnDef","UsuarioAsignado"],["matColumnDef","estado"],["mat-header-cell","","mat-sort-header","","class","text-center px-4 py-2 bg-gray-200 font-semibold text-gray-800",4,"matHeaderCellDef"],["mat-cell","","class","px-4 py-2 text-center border-b border-gray-200",4,"matCellDef"],["matColumnDef","operaciones"],["mat-header-cell","","class","text-center px-4 py-2 bg-gray-200 font-semibold text-gray-800",4,"matHeaderCellDef"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","","class","hover:bg-gray-100 transition-all duration-150",4,"matRowDef","matRowDefColumns"],[3,"citaSeleccionada","detalleProductos","cantidadInventarios"],[3,"rucEmpresa","idCarga","getUsuarios_All","UsuarioAsignado","Inventario"],[1,"text-indigo-500","font-semibold","text-sm","leading-tight"],[1,"text-gray-600","text-sm","leading-tight","truncate","w-64"],["mat-header-cell","","mat-sort-header","",1,"text-left","px-4","py-2","bg-gray-200","font-semibold","text-gray-800"],["mat-cell","",1,"px-4","py-2","border-b","border-gray-200"],[1,"text-sm","text-gray-700"],[1,"text-sm","font-semibold","text-gray-800"],["mat-header-cell","","mat-sort-header","",1,"text-right","px-4","py-2","bg-gray-200","font-semibold","text-gray-800"],["mat-cell","",1,"px-4","py-2","text-right","border-b","border-gray-200"],[1,"py-1","text-sm","font-medium","text-gray-700"],["mat-header-cell","","mat-sort-header","",1,"text-center","px-4","py-2","bg-gray-200","font-semibold","text-gray-800"],["mat-cell","",1,"px-4","py-2","text-center","border-b","border-gray-200"],["estado","'Inventariado'"],[3,"estado"],["mat-header-cell","",1,"text-center","px-4","py-2","bg-gray-200","font-semibold","text-gray-800"],[1,"flex","justify-center","gap-2"],[3,"obtenerDetalle","idcarga","rucempresa"],[3,"obtenerDetalle","idcarga","rucempresa","datosInventario"],["mat-header-row",""],["mat-row","",1,"hover:bg-gray-100","transition-all","duration-150"]],template:function(a,o){if(a&1){let l=A();n(0,"div",1)(1,"mat-form-field",2)(2,"mat-label"),r(3,"Filtro Empresas"),e(),n(4,"mat-select",3),P("valueChange",function(m){return _(l),L(o.selectedEmpresa,m)||(o.selectedEmpresa=m),f(m)}),x("selectionChange",function(){return _(l),f(o.emitirFiltros())}),n(5,"mat-option",4)(6,"div",5)(7,"div",6)(8,"span",7),r(9,"Todos"),e()()()(),S(10,Pe,7,3,"mat-option",8,G),e()(),n(12,"mat-form-field")(13,"mat-label"),r(14,"Filtro Estados"),e(),n(15,"mat-select",9),P("valueChange",function(m){return _(l),L(o.selected,m)||(o.selected=m),f(m)}),x("selectionChange",function(){return _(l),f(o.emitirFiltros())}),S(16,ze,2,2,"mat-option",10,G),e()(),n(18,"mat-form-field",11)(19,"mat-icon",12),r(20," search "),e(),n(21,"input",13,0),x("keyup",function(m){return _(l),f(o.applyFilter(m))}),e()()(),n(23,"section")(24,"div",14)(25,"div",15)(26,"div",16)(27,"div",17)(28,"div",18)(29,"div",19)(30,"table",20),Z(31,21),C(32,Re,2,0,"th",22)(33,je,4,4,"td",23),K(),Z(34,24),C(35,Ne,2,0,"th",22)(36,Be,3,1,"td",23),K(),Z(37,25),C(38,Ve,2,0,"th",26)(39,Ue,3,1,"td",27),K(),Z(40,28),C(41,He,2,0,"th",22)(42,Qe,3,1,"td",23),K(),Z(43,29),C(44,Ge,2,0,"th",30)(45,$e,4,3,"td",31),K(),Z(46,32),C(47,Ze,2,0,"th",33)(48,Ye,4,3,"td",31),K(),C(49,Je,1,0,"tr",34)(50,tn,1,0,"tr",35),e()()()()()()()(),h(51,"detalle-carga-inventarios",36)(52,"registro-asignar-page",37)(53,"registro-producto-new-inventario")}a&2&&(d(4),T("value",o.selectedEmpresa),d(6),F(o.DatosEmpresas),d(5),T("value",o.selected),d(),F(o.filtroEstados),d(14),g("dataSource",o.dataSource),d(19),g("matHeaderRowDef",o.displayedColumns),d(),g("matRowDefColumns",o.displayedColumns),d(),g("citaSeleccionada",o.datosInventario)("detalleProductos",o.listaProductos)("cantidadInventarios",o.cantidadListaProductos),d(),g("rucEmpresa",o.datosInventario.rucempresa)("idCarga",o.datosInventario.idcarga)("getUsuarios_All",o.getUsuarios_All)("UsuarioAsignado",o.datosInventario.UsuarioAsignado)("Inventario",o.datosInventario.Descripcion))},dependencies:[ae,oe,xi,Li,Oi,Pi,Wi,zi,rt,it,$,wi,nt,mi,ci,si,at,gi,Mt,ki,Ci,Si,Ii,yi,Fi,Mi,Ei,Ai,Di,ee,ji,Ni,Bi,Ct,pi,di,tt,de,X,Xt,Ui,St,Vi],styles:["table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{background-color:#f5f5f5}"]})}}return i})();var me=Dt(Pt());var se=(()=>{class i{static{this.\u0275fac=function(a){return new(a||i)}}static{this.\u0275mod=j({type:i})}static{this.\u0275inj=R({imports:[B,B]})}}return i})();var he=(()=>{class i{constructor(){this.listaEmpresas=M(ot),this.listaUsuarios=M(et),this.listaInventariosbyfiltros=M(Hi),this.datosInventarioslista=[],this.datosFiltrados=[],this.getEmpresas_All=[],this.getUsuarios_All=[],this.datosPaginated=[],this.cantidadDatosInventarioLista=0,this.p=1,this.itemsPerPage=10,this.cantidadDatosFiltrados=0,this.dataSource=new Et,this.selectedEmpresa="",this.selected=""}ngOnInit(){this.listarInventarios("1",""),this.listarEmpresas(),this.listarUsuarios()}applyFilter(t){let a=t.target.value.toUpperCase();this.dataSource.filter=a.trim().toLowerCase(),this.dataSource.paginator?.firstPage()}aplicarFiltros(t){this.listarInventarios(t.estado,t.rucempresa)}listarInventarios(t,a){let o={rucempresa:a,estado:t};o.estado=t,o.rucempresa=a;try{this.inventarioSubscription=this.listaInventariosbyfiltros.getInventariosByFiltros(o).subscribe({next:l=>{Array.isArray(l)?(this.datosInventarioslista=l,this.datosFiltrados=l,this.cantidadDatosInventarioLista=l.length):(this.mostrarMensajeError("DATOS NO V\xC1LIDOS",`${l}`),this.datosInventarioslista=[],this.cantidadDatosInventarioLista=0)},error:l=>{this.mostrarMensajeError(l.name,"Verifique la conexi\xF3n con el API y recargue el listado."),this.datosInventarioslista=[],this.cantidadDatosInventarioLista=0}})}catch(l){this.mostrarMensajeError("Error inesperado",`Error en listarInventarios: ${l}`)}}listarEmpresas(){try{this.EmpresasSubscription=this.listaEmpresas.ListarEmpresas().subscribe(t=>{this.getEmpresas_All=t.empresas})}catch{}}listarUsuarios(){try{this.UsuariosSubscription=this.listaUsuarios.ListarusUarios().subscribe(t=>{this.getUsuarios_All=t.usuarios})}catch{}}mostrarMensajeError(t,a){me.default.fire({icon:"error",title:t,text:a})}ngOnDestroy(){this.EmpresasSubscription?.unsubscribe(),this.UsuariosSubscription?.unsubscribe(),this.inventarioSubscription?.unsubscribe()}static{this.\u0275fac=function(a){return new(a||i)}}static{this.\u0275cmp=k({type:i,selectors:[["app-lista-carga-inventarios"]],standalone:!0,features:[y],decls:24,vars:1,consts:[[1,"sticky","top-0","inset-x-0","flex","flex-wrap","md:justify-start","md:flex-nowrap","z-[48]","w-full","bg-white","border-b","text-sm","py-2.5","lg:ps-[260px]","dark:bg-neutral-800","dark:border-neutral-700"],[1,"px-4","sm:px-6","flex","basis-full","items-center","w-full","mx-auto"],[1,"me-5","lg:me-0","lg:hidden"],["aria-label","Preline",1,"flex-none","rounded-md","text-xl","no-underline","font-semibold"],[1,"md:flex-1"],[1,"lg:hidden","ms-1"],[1,"w-full","flex","items-center","justify-end","ms-auto","md:justify-between","gap-x-1","md:gap-x-3"],[1,"hidden","lg:block"],[1,"flex","flex-row","items-center","justify-end","gap-1"],[1,"md:block"],[1,"relative"],["type","button","data-bs-toggle","modal","data-bs-target","#registrarInventario",1,"py-2","px-3","inline-flex","items-center","gap-x-2","text-sm","font-medium","rounded-lg","border","border-transparent","bg-blue-600","text-white","hover:bg-blue-700","focus:outline-none","focus:bg-blue-700","disabled:opacity-50","disabled:pointer-events-none"],[1,"mat-18"],[1,"w-full","lg:ps-64","h-auto"],[1,"w-full","lg:ps-0","h-auto"],[1,"px-4","sm:px-4","sm:pt-4","h-auto","space-y-4","sm:space-y-6"],[3,"filtrosInventario","dataListaInventarios"]],template:function(a,o){a&1&&(n(0,"header",0)(1,"nav",1)(2,"div",2)(3,"a",3)(4,"h3",4)(5,"span"),r(6,"CARGAR INVENTARIO"),e()()(),h(7,"div",5),e(),n(8,"div",6)(9,"div",7)(10,"h3",8)(11,"span"),r(12,"CARGAR INVENTARIO"),e()()(),n(13,"div",9)(14,"div",10)(15,"button",11)(16,"mat-icon",12),r(17,"add"),e(),r(18," Nuevo "),e()()()()()(),n(19,"div",13)(20,"div",14)(21,"div",15)(22,"lista-inventarios-cargados",16),x("filtrosInventario",function(s){return o.aplicarFiltros(s)}),e()()()(),h(23,"registro-carga-inventarios")),a&2&&(d(22),g("dataListaInventarios",o.datosInventarioslista))},dependencies:[ce,qi,at,nt,Mt,se,$],styles:["h3[_ngcontent-%COMP%]{flex:1;text-align:left;font-size:1.5rem;color:#fff;margin-bottom:0}h3[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{color:#20477e}"]})}}return i})();var So=[{path:"",component:he}];export{So as CARGA_INVENTARIOS_ROUTES};
